<html>
  <%= render "games/all_pages_nav" %>

  <%= form_with(url: update_roles_users_path, method: :post, id: "roles_form") do %>
    <table>
      <caption>All Users</caption>
      <thead>
        <tr>
          <% ["first_name", "last_name", "email", "github_username", "spotify_username", "roles"].each do |attr| %>
            <th style="color:white;">
              <%= attr.capitalize.sub("_", " ") %>
            </th>
          <% end %>
        </tr>
      </thead>
      <tbody>
        <% @users.each do |user| %>
          <tr>
            <td><%= user.first_name %></td>
            <td><%= user.last_name %></td>
            <td><%= user.email %></td>
            <td><%= user.github_username %></td>
            <td><%= user.spotify_username %></td>
            <td>
              <% @all_roles.each do |role| %>
                <div class="role-section" style="<%= ["Puzzle Setter", "Puzzle Aesthetician"].include?(role) ? 'margin-bottom: 20px; padding: 10px; border: 1px solid #ccc; background-color: black;' : '' %>">
                  <label style="display: block;">
                    <input type="checkbox" 
                           class="role-checkbox" 
                           name="user_roles[<%= user.id %>][]"
                           value="<%= role %>"
                           <%= user.roles.map(&:role).include?(role) ? 'checked' : '' %> />
                    <%= role %>
                  </label>

                  <% if ["Puzzle Setter", "Puzzle Aesthetician"].include?(role) %>
                    <div class="games-checkboxes" style="margin-left: 20px; margin-top: 10px;">
                      <% @all_games.each do |game| %>
                        <label style="display: inline-block; margin-right: 10px;">
                          <input type="checkbox" 
                                 class="game-checkbox" 
                                 name="user_roles_games[<%= user.id %>][<%= role %>][]"
                                 value="<%= game %>"
                                 <%= user.roles.any? { |r| r.role == role && r.game&.name == game } ? 'checked' : '' %> />
                          <%= game %>
                        </label>
                      <% end %>
                    </div>
                  <% end %>
                </div> <!-- End of role-section -->
              <% end %>
            </td>
          </tr>
          <tr>
            <td colspan="4" style="border-bottom: 2px solid white;"></td>
          </tr>
        <% end %>
      </tbody>
    </table>
    <div style="display: flex; justify-content: center;">
      <%= submit_tag "Update Roles", class: "btn-login" %>
    </div>
  <% end %>
</html>
